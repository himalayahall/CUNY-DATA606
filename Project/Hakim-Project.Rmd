---
title: DATA 606 Hakim - Project
author: "Jawaid Hakim"
date: "`r Sys.Date()`"
output:
     powerpoint_presentation:
            reference_doc: data606-finalproject.pptx
---

```{r load-library, include=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(ggplot2)
library(infer)
```


```{r setup, include=FALSE, message=FALSE, warning=FALSE}
df <- read_csv(file = "https://raw.githubusercontent.com/himalayahall/CUNY-DATA606/master/Project/resume_callback.csv",
               col_types = cols(
                   
                    job_ad_id = col_character(),
                    firstname = col_character(),
                    
                    job_city = col_factor(),
                    job_industry = col_factor(),
                    job_type = col_factor(),
                    job_ownership = col_factor(),
                    job_req_school = col_factor(),
                    resume_quality = col_factor(ordered = TRUE, levels = c('low', 'high')),
                    race = col_factor(),
                    gender = col_factor(),
                    received_callback = col_factor(),
 
                    job_req_min_experience = col_character(),
                    years_experience = col_integer(),
                    years_college = col_factor(ordered = TRUE, levels = c('0', '1', '2', '3', '4')),
                    
                    .default = col_logical()
                     
               ))
```

```{r mutate-data, include=FALSE, message=FALSE, warning=FALSE}
df$received_callback_cat <- recode_factor(df$received_callback, `0` = "No",  `1` = 'Yes')
df <- df |> select(-job_ad_id)
```

# Overview

Researchers randomly generated realistic resumes to send to job postings in Boston and Chicago. They then randomly assigned a *first name* to the resume that would communicate the race and gender of the application.  

First names for the study were selected so that the names would predominantly be recognized as belonging to black or white individuals.  

1. All other factors being equal does the perceived **race** of applicants have a meaningful impact on the callback rate?


# Data - [OpenIntro](https://www.openintro.org/data/index.php?data=resume). 


1. Each case represents a randomly generated resumes There are 4870 cases.
1. This was an **experiment** conducted over several months during 2001 and 2002 in Boston and Chicago.
1. The categorical response variable is the **received_callback**
1. The categorical explanatory (predictor) variable is the **race**

# Summary Statistics

```{r set-seed, include=FALSE, message=FALSE, warning=FALSE}
set.seed(1234)
```

Of all applicants who received a callback, 60% were perceived to be White and 40% were perceived to be Black

```{r echo=FALSE, message=FALSE, warning=FALSE}
df |> 
    filter(received_callback_cat == 'Yes') |> 
    count(race) |> 
    mutate(p = n / sum(n))
```

# Compute sample proportion

```{r compute-sample-props, message=FALSE, warning=FALSE}
sample_props <- df |>
                    rep_sample_n(size = 500, 
                                 reps = 1000, 
                                 replace = TRUE) |>
                    count(received_callback_cat) |>
                    mutate(p_hat = n /sum(n)) |>
                    filter(received_callback_cat == 'Yes')
```

# Plot sample proportion

```{r plot-sample-props, echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Sample Proportion"}
ggplot(data = sample_props, aes(x = p_hat)) +
  geom_histogram(binwidth = 0.005)

```

# Hypothesis

$H_0$: there is no difference in callback proportion between candidates who are perceived to be white and those perceived to be black  
$H_A$: candidates who are white are more likely to receive callback

95% Confidence Interval for the sample proportion:

```{r compute-ci, echo=FALSE, message=FALSE, warning=FALSE}
df |>
  specify(response = received_callback_cat, success = 'Yes') |>
  generate(reps = 1000, type = 'bootstrap') |>
  calculate(stat = 'prop') |>
  get_ci(level = 0.95)
```

# Chi-square Testing framework

Assumptions for using Chi-square:

1. Both variables are categorical
1. Observations are independent
1. Individuals can only belong to one cell in the contingency table. That is, cells in the table are mutually exclusive â€“ an individual cannot belong to more than one cell
1. There must be at least 5 frequencies in each cell

Our dataset satisfies all above assumptions.  

# Compute Chi-square

```{r include=FALSE, message=FALSE, warning=FALSE}
observed_ind_stat <- df |>
    specify(received_callback_cat ~ race, 
            success = 'Yes') |>
    hypothesize(null = 'independence') |>
    calculate(stat = 'Chisq', c('white', 'black'))
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
observed_ind_stat
```

# Compute null distribution

The null distribution is what we would expect to see if the response and explanatory variables were truly independent.

```{r message=FALSE, warning=FALSE}
null_dist_sim <- df |>
  specify(received_callback_cat ~ race, 
          success = 'Yes') |>
  hypothesize(null = 'independence') |>
  generate(reps = 500, 
           type = 'permute') |>
  calculate(stat = 'Chisq', 
            c('white', 'black'))
```

# Plot null distribution

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.align='center'}
null_dist_sim |>
  visualize(method = 'both') + 
  shade_p_value(observed_ind_stat,
                direction = 'greater')
```

Plot of null distribution shows that the observed test statistic would be unlikely if there was no association between $race$ and $callback\_rate$. So we reject $H_0$ in favor $H_A$.

# Plot

```{r echo=FALSE}
library(ggstatsplot)

# plot
ggbarstats(
  data = df,
  x = received_callback_cat,
  y = race
) +
  labs(caption = NULL) # remove caption
```


```{r include=FALSE, message=FALSE, warning=FALSE}
p_value_independence <- null_dist_sim |>
   get_p_value(obs_stat = observed_ind_stat,
               direction = 'greater')
 p_value_independence
```

```{r include=FALSE, message=FALSE, warning=FALSE}
# df <- df |> mutate(num_received_callback = ifelse(received_callback == 'Yes', 1, 0))
# mlm <- lm(num_received_callback ~ college_degree + resume_quality + volunteer + computer_skills + years_experience + honors + gender + race, data = df)
# summary(mlm)
```

```{r include=FALSE, message=FALSE, warning=FALSE}
# mlm2 <- lm(num_received_callback ~  resume_quality + computer_skills + years_experience + honors + race, data = df)
# summary(mlm2)
```

# Limitations

This analysis looked at just $race$ as the explanatory variable. However, the dataset contains other variables (see below) that may have an impact on the $callback\_rate$. A multiple regression model could be used to identify combinations of explanatory variables.

1. Gender
1. Resume Quality
1. Computer Skills
1. Years of Experience

